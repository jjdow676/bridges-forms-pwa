<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#3AAFA9">
    <meta name="description" content="Bridges Forms - Quick access to Interest, Application, and Enrollment forms">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Bridges Forms">
    <title>Bridges Forms</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-72.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="stylesheet" href="styles.css">
    <!-- Microsoft Authentication Library -->
    <script src="https://alcdn.msauth.net/browser/2.38.3/js/msal-browser.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- Login Screen (shown when not authenticated) -->
        <section id="login-screen" class="login-screen">
            <div class="login-container">
                <img src="icons/icon-192.png" alt="Bridges Forms" class="login-logo">
                <h1>Bridges Forms</h1>
                <p class="login-description">Sign in with your Bridges account to access participant forms</p>
                <button id="login-btn" class="login-btn">
                    <svg class="microsoft-logo" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
                        <rect x="1" y="1" width="9" height="9" fill="#f25022"/>
                        <rect x="11" y="1" width="9" height="9" fill="#7fba00"/>
                        <rect x="1" y="11" width="9" height="9" fill="#00a4ef"/>
                        <rect x="11" y="11" width="9" height="9" fill="#ffb900"/>
                    </svg>
                    Sign in with Microsoft
                </button>
                <p class="login-note">Only @bridgestowork.org accounts are allowed</p>
            </div>
        </section>

        <!-- Install Banner (shown for non-installed users) -->
        <div id="install-banner" class="install-banner hidden">
            <div class="install-banner-content">
                <div class="install-banner-icon">
                    <img src="icons/icon-96.png" alt="App Icon" width="48" height="48">
                </div>
                <div class="install-banner-text">
                    <strong>Install Bridges Forms</strong>
                    <p>Add to your home screen for quick access</p>
                </div>
            </div>
            <div class="install-banner-actions">
                <button id="install-banner-btn" class="install-banner-install">Install</button>
                <button id="dismiss-banner" class="install-banner-dismiss">Later</button>
            </div>
        </div>

        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <img src="icons/bridges-logo.png" alt="Bridges" class="logo" onerror="this.style.display='none'">
                <h1>Bridges Forms</h1>
            </div>
            <div class="header-right">
                <span id="user-name" class="user-name"></span>
                <button id="logout-btn" class="logout-btn" title="Sign out">Sign Out</button>
            </div>
        </header>

        <!-- Step 1: Site Selection -->
        <section id="step-site-select" class="step active">
            <h2>Select Your Site</h2>
            <p class="step-description">Choose your Bridges location</p>

            <div class="site-grid" id="site-grid">
                <!-- Sites will be populated by JavaScript -->
            </div>
        </section>

        <!-- Step 2: Form Selection -->
        <section id="step-form-select" class="step">
            <button class="back-btn" id="back-to-sites">‚Üê Back</button>
            <h2>Select Form Type</h2>
            <p class="step-description">Choose the form you want to fill out</p>

            <!-- Job Placement Forms (always shown) -->
            <h3 class="form-section-header">Job Placement Forms</h3>
            <div class="form-cards">
                <button class="form-card" data-form="interest">
                    <div class="card-icon">üìù</div>
                    <div class="card-content">
                        <h3>Interest Form</h3>
                        <p>New participant expressing interest in Bridges programs</p>
                    </div>
                    <div class="card-arrow">‚Üí</div>
                </button>

                <button class="form-card" data-form="application">
                    <div class="card-icon">üìã</div>
                    <div class="card-content">
                        <h3>Application Form</h3>
                        <p>Complete application for existing participants</p>
                    </div>
                    <div class="card-arrow">‚Üí</div>
                </button>

                <button class="form-card" data-form="enrollment">
                    <div class="card-icon">‚úÖ</div>
                    <div class="card-content">
                        <h3>Enrollment Form</h3>
                        <p>Final enrollment for accepted participants</p>
                    </div>
                    <div class="card-arrow">‚Üí</div>
                </button>
            </div>

            <!-- Other Forms (conditionally shown based on site) -->
            <div id="other-forms-section" class="form-section hidden">
                <h3 class="form-section-header">Other Forms</h3>
                <div class="form-cards">
                    <button class="form-card" data-form="preEtsInterest" id="preEtsCard">
                        <div class="card-icon">üéì</div>
                        <div class="card-content">
                            <h3>Pre-ETS Interest Form</h3>
                            <p>Pre-Employment Transition Services interest form</p>
                        </div>
                        <div class="card-arrow">‚Üí</div>
                    </button>

                    <button class="form-card" data-form="educationalPlacement" id="educationalPlacementCard">
                        <div class="card-icon">üè´</div>
                        <div class="card-content">
                            <h3>Educational Placement Form</h3>
                            <p>Educational placement interest form</p>
                        </div>
                        <div class="card-arrow">‚Üí</div>
                    </button>
                </div>
            </div>
        </section>

        <!-- Step 3: Participant Search -->
        <section id="step-search" class="step">
            <button class="back-btn" id="back-to-forms">‚Üê Back</button>
            <h2>Find Participant</h2>
            <p class="step-description">Search by name to pre-fill the <span id="selected-form-name"></span></p>
            <p class="site-filter-note">Showing participants from: <strong id="selected-site-name"></strong></p>

            <div class="search-container">
                <div class="search-input-wrapper">
                    <input
                        type="text"
                        id="search-input"
                        placeholder="Type participant name..."
                        autocomplete="off"
                        autocorrect="off"
                        autocapitalize="off"
                        spellcheck="false"
                    >
                    <div class="search-icon">üîç</div>
                    <div class="loading-spinner" id="search-spinner"></div>
                </div>

                <div id="search-results" class="search-results"></div>
            </div>

            <div class="skip-search">
                <button id="skip-search-btn" class="secondary-btn">
                    Skip Search - Open Blank Form
                </button>
            </div>
        </section>

        <!-- Step 4: Confirm & Launch -->
        <section id="step-confirm" class="step">
            <button class="back-btn" id="back-to-search">‚Üê Back</button>
            <h2>Ready to Launch</h2>

            <div class="confirm-details">
                <div class="confirm-card">
                    <div class="confirm-row">
                        <span class="label">Site:</span>
                        <span id="confirm-site" class="value"></span>
                    </div>
                    <div class="confirm-row">
                        <span class="label">Form:</span>
                        <span id="confirm-form" class="value"></span>
                    </div>
                    <div class="confirm-row" id="confirm-participant-row">
                        <span class="label">Participant:</span>
                        <span id="confirm-participant" class="value"></span>
                    </div>
                    <div class="confirm-row" id="confirm-email-row">
                        <span class="label">Email:</span>
                        <span id="confirm-email" class="value"></span>
                    </div>
                </div>
            </div>

            <button id="launch-form-btn" class="primary-btn">
                Open Form ‚Üí
            </button>
        </section>

        <!-- Install Prompt -->
        <div id="install-prompt" class="install-prompt hidden">
            <p>Install Bridges Forms for quick access</p>
            <div class="install-buttons">
                <button id="install-btn" class="install-btn">Install</button>
                <button id="dismiss-install" class="dismiss-btn">Not now</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
